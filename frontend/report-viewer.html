<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NYP2VB4YBE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-NYP2VB4YBE');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Brand Intelligence Report | GeoVera</title>
    <meta name="description" content="AI-powered brand intelligence report generated by GeoVera">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Georgia:wght@400;700&display=swap" rel="stylesheet">

    <!-- Preconnect for faster loading -->
    <link rel="preconnect" href="https://vozjwptzutolvkvfpknk.supabase.co">
    <link rel="dns-prefetch" href="https://images.unsplash.com">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --gv-green-500: #16a34a;
            --gv-green-600: #15803d;
            --gv-green-700: #166534;
            --gv-green-50: #f0fdf4;
            --gv-gray-50: #f9fafb;
            --gv-gray-100: #f2f4f7;
            --gv-gray-700: #344054;
            --gv-gray-800: #1d2939;
            --gv-gray-900: #101828;
            --font-sans: 'Inter', sans-serif;
            --font-serif: 'Georgia', serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            line-height: 1.7;
            color: var(--gv-gray-800);
            background: var(--gv-gray-50);
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gv-gray-100);
            border-top: 4px solid var(--gv-green-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Header */
        .report-header {
            background: white;
            border-bottom: 3px solid var(--gv-green-500);
            padding: 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--gv-green-500);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-serif);
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .logo-text {
            font-family: var(--font-serif);
            font-size: 20px;
            font-weight: 700;
            color: var(--gv-gray-900);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--gv-green-500);
            color: white;
        }

        .btn-primary:hover {
            background: var(--gv-green-600);
        }

        .btn-secondary {
            background: white;
            color: var(--gv-gray-700);
            border: 1px solid var(--gv-gray-300);
        }

        .btn-secondary:hover {
            background: var(--gv-gray-50);
        }

        /* Report Container */
        .report-container {
            max-width: 900px;
            margin: 40px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .report-meta {
            background: linear-gradient(135deg, var(--gv-green-500) 0%, var(--gv-green-700) 100%);
            color: white;
            padding: 32px;
        }

        .report-meta h1 {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .report-meta .meta-info {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            font-size: 14px;
            opacity: 0.95;
        }

        .report-content {
            padding: 48px;
        }

        /* Markdown Styles */
        .report-content h2 {
            font-family: var(--font-serif);
            font-size: 2rem;
            color: var(--gv-gray-900);
            margin: 48px 0 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--gv-green-500);
        }

        .report-content h2:first-child {
            margin-top: 0;
        }

        .report-content h3 {
            font-size: 1.4rem;
            color: var(--gv-gray-800);
            margin: 32px 0 16px;
        }

        .report-content p {
            margin-bottom: 16px;
            line-height: 1.8;
            color: var(--gv-gray-700);
        }

        .report-content ul, .report-content ol {
            margin: 16px 0 16px 24px;
        }

        .report-content li {
            margin-bottom: 8px;
            line-height: 1.7;
        }

        .report-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
            border: 1px solid var(--gv-gray-200);
            border-radius: 8px;
            overflow: hidden;
        }

        .report-content thead {
            background: var(--gv-green-500);
            color: white;
        }

        .report-content th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
        }

        .report-content td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gv-gray-100);
        }

        .report-content tr:last-child td {
            border-bottom: none;
        }

        .report-content strong {
            color: var(--gv-gray-900);
            font-weight: 600;
        }

        /* Footer */
        .report-footer {
            background: var(--gv-gray-900);
            color: var(--gv-gray-400);
            padding: 32px 24px;
            text-align: center;
        }

        .report-footer p {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .report-footer a {
            color: var(--gv-green-500);
            text-decoration: none;
        }

        /* Error State */
        .error-state {
            text-align: center;
            padding: 80px 24px;
        }

        .error-state h2 {
            font-size: 2rem;
            color: var(--gv-gray-900);
            margin-bottom: 16px;
        }

        .error-state p {
            color: var(--gv-gray-600);
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .report-meta h1 {
                font-size: 2rem;
            }

            .report-content {
                padding: 24px;
            }

            .header-content {
                flex-direction: column;
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading State -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading intelligence report...</p>
    </div>

    <!-- Report Content (Hidden initially) -->
    <div id="report-view" style="display: none;">
        <header class="report-header">
            <div class="header-content">
                <a href="https://geovera.xyz" class="logo">
                    <div class="logo-icon">G</div>
                    <span class="logo-text">GeoVera</span>
                </a>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="window.print()">üìÑ Download PDF</button>
                    <a href="https://geovera.xyz/onboarding.html" class="btn btn-primary">Get Your Report</a>
                </div>
            </div>
        </header>

        <div class="report-container">
            <div class="report-meta">
                <h1 id="brand-name">Loading...</h1>
                <div class="meta-info">
                    <span id="parent-company"></span>
                    <span id="category"></span>
                    <span id="generated-date"></span>
                </div>
            </div>

            <div class="report-content" id="markdown-content">
                <!-- Markdown content will be rendered here -->
            </div>
        </div>

        <footer class="report-footer">
            <p>¬© 2026 GeoVera Intelligence Platform</p>
            <p>Powered by Perplexity, Gemini, Claude & GPT-4o</p>
            <p><a href="https://geovera.xyz">Get your brand intelligence report ‚Üí</a></p>
        </footer>
    </div>

    <script>
        const SUPABASE_URL = 'https://vozjwptzutolvkvfpknk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvemp3cHR6dXRvbHZrdmZwa25rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODI0NzcsImV4cCI6MjA4NTQ1ODQ3N30.p-RiTR1Iva9Y4KiZu8gnF2CZjvnMWNAHUVCbp57PDF8';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Get brand slug from URL
        const urlParams = new URLSearchParams(window.location.search);
        const brandSlug = urlParams.get('brand') || 'demo';

        async function loadReport() {
            try {
                console.log('[Report Viewer] Loading report for:', brandSlug);

                // Check localStorage first (from onboarding flow)
                const localHtml = localStorage.getItem('report_html_' + brandSlug);
                if (localHtml) {
                    console.log('[Report Viewer] Found report in localStorage');
                    renderFullHtml(localHtml);
                    return;
                }

                // For demo, show Kata Oma report
                if (brandSlug === 'kata-oma' || brandSlug === 'demo') {
                    showDemoReport();
                    return;
                }

                // In production, fetch from Supabase
                const { data, error } = await supabase
                    .from('brand_reports')
                    .select('*')
                    .eq('slug', brandSlug)
                    .eq('public', true)
                    .single();

                if (error) throw error;

                if (data) {
                    renderReport(data);
                } else {
                    showError('Report not found');
                }

            } catch (error) {
                console.error('[Report Viewer] Error:', error);
                showError('Failed to load report');
            }
        }

        function renderFullHtml(htmlContent) {
            // For full HTML reports from report-generator-v2, replace the entire page
            document.getElementById('loading').style.display = 'none';
            document.getElementById('report-view').style.display = 'none';

            // Create iframe to render full HTML report
            const iframe = document.createElement('iframe');
            iframe.style.cssText = 'width:100%;height:100vh;border:none;position:fixed;top:0;left:0;z-index:1000;';
            document.body.appendChild(iframe);
            iframe.contentDocument.open();
            iframe.contentDocument.write(htmlContent);
            iframe.contentDocument.close();

            // Add back button overlay
            const backBtn = document.createElement('div');
            backBtn.innerHTML = '<a href="dashboard.html" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:white;color:#344054;border-radius:8px;text-decoration:none;font-family:Inter,sans-serif;font-size:14px;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.15);border:1px solid #e5e7eb;">‚Üê Back to Dashboard</a>';
            backBtn.style.cssText = 'position:fixed;top:16px;left:16px;z-index:1001;';
            document.body.appendChild(backBtn);
        }

        function showDemoReport() {
            // Demo report for Kata Oma
            const demoData = {
                brand_name: 'Kata Oma',
                parent_company: 'PT. United Family Food (Unifam)',
                category: 'Snacks ‚Üí Telur Gabus',
                generated_at: '2026-02-17',
                report_markdown: `# KATA OMA INTELLIGENCE REPORT

## 1. BRAND OVERVIEW

**Kata Oma** is a traditional Indonesian snack brand specializing in authentic telur gabus (crispy egg sticks).

**Quick Facts:**
‚Ä¢ **Founded**: 2018 | **Headquarters**: Indonesia
‚Ä¢ **Parent Company**: PT. United Family Food (Unifam)
‚Ä¢ **Category**: Snacks ‚Üí Telur Gabus
‚Ä¢ **Market**: Indonesia

**What Makes Them Different:**
Kata Oma stands out with its commitment to authenticity, using a heritage recipe from 1980 with over 20% egg content and zero preservatives.

---

## 2. BRAND DNA

**Core Values:**
‚Ä¢ Authenticity
‚Ä¢ Heritage Preservation
‚Ä¢ Natural Quality
‚Ä¢ Family Tradition

**Market Position:**
Mid-tier heritage snack brand focused on traditional Indonesian telur gabus, leveraging Unifam's extensive distribution network.

---

## 3. COMPETITIVE ANALYSIS

| Competitor | Market Share | Key Strength |
|------------|--------------|--------------|
| GarudaFood | 25% | Nostalgic brand, family packs |
| Mayora Indah | 20% | Innovation, export focus |
| Kata Oma | 8-10% | Heritage authenticity |

---

## 4. STRATEGIC RECOMMENDATIONS

**Immediate Actions (Next 30 Days):**
1. Launch targeted social media campaign on Instagram and TikTok
2. Partner with local food influencers
3. Conduct market research for new flavor variants

**Long-term Vision:**
Become Indonesia's leading heritage snack brand by 2027, expanding internationally through tourism channels.

---

*This is a demo report. Generated by GeoVera's AI-powered intelligence platform using Perplexity, Gemini, Claude & GPT-4o.*`
            };

            renderReport(demoData);
        }

        function renderReport(data) {
            // Update page title
            document.getElementById('page-title').textContent = `${data.brand_name} Intelligence Report | GeoVera`;

            // Update meta info
            document.getElementById('brand-name').textContent = `${data.brand_name} Intelligence Report`;
            document.getElementById('parent-company').textContent = `üè¢ ${data.parent_company}`;
            document.getElementById('category').textContent = `üì¶ ${data.category}`;
            document.getElementById('generated-date').textContent = `üìÖ ${new Date(data.generated_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`;

            // Render markdown content (simple fallback - no marked.js needed)
            const markdownContent = data.report_markdown || '';

            // Simple markdown to HTML conversion (basic)
            let htmlContent = markdownContent
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');

            htmlContent = '<p>' + htmlContent + '</p>';
            document.getElementById('markdown-content').innerHTML = htmlContent;

            // Hide loading, show report
            document.getElementById('loading').style.display = 'none';
            document.getElementById('report-view').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('loading').innerHTML = `
                <div class="error-state">
                    <h2>‚ùå ${message}</h2>
                    <p>The report you're looking for doesn't exist or is no longer available.</p>
                    <a href="https://geovera.xyz/onboarding.html" class="btn btn-primary">Create Your Own Report</a>
                </div>
            `;
        }

        // Load report on page load
        loadReport();
    </script>
</body>
</html>
