<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding - GeoVera</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #F9FAFB;
            padding: 32px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border: 2px solid #E5E7EB;
            padding: 48px;
        }
        h1 {
            font-family: Georgia, serif;
            font-size: 32px;
            margin-bottom: 8px;
            color: #0B0F19;
        }
        .subtitle { color: #6B7280; margin-bottom: 32px; }
        .field { margin-bottom: 24px; }
        label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: #0B0F19;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #16A34A;
        }
        .helper-text {
            font-size: 12px;
            color: #6B7280;
            margin-top: 4px;
        }
        button {
            width: 100%;
            padding: 16px;
            background: #16A34A;
            color: white;
            border: none;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        button:hover { background: #15803d; }
        button:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
        }
        .message {
            padding: 16px;
            margin-bottom: 24px;
            border: 2px solid;
            display: none;
        }
        .message.show { display: block; }
        .message.success {
            background: #D1FAE5;
            border-color: #16A34A;
            color: #065F46;
        }
        .message.error {
            background: #FEE2E2;
            border-color: #DC2626;
            color: #991B1B;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Create Your Brand</h1>
        <p class="subtitle">Let's set up your brand profile</p>
        <div id="message" class="message"></div>
        <form id="onboarding-form">
            <div class="field">
                <label>Brand Name *</label>
                <input type="text" id="brand_name" required placeholder="e.g., Nike, Shopee">
                <p class="helper-text">Your brand or company name</p>
            </div>
            <div class="field">
                <label>Category *</label>
                <select id="category" required>
                    <option value="">Select a category</option>
                    <option value="agency">Agency</option>
                    <option value="beauty">Beauty</option>
                    <option value="car_motorcycle">Car & Motorcycle</option>
                    <option value="consultant">Consultant</option>
                    <option value="contractor">Contractor</option>
                    <option value="ecommerce">E-Commerce</option>
                    <option value="education">Education</option>
                    <option value="event_organizer">Event Organizer</option>
                    <option value="fashion">Fashion & Apparel</option>
                    <option value="finance">Finance</option>
                    <option value="fmcg">FMCG</option>
                    <option value="fnb">Food & Beverage</option>
                    <option value="health">Health & Wellness</option>
                    <option value="lifestyle">Lifestyle</option>
                    <option value="mom_baby">Mom & Baby</option>
                    <option value="other">Others</option>
                    <option value="photo_video">Photo & Video</option>
                    <option value="saas">SaaS & Technology</option>
                </select>
            </div>
            <div class="field">
                <label>Country *</label>
                <select id="country" required>
                    <option value="">Select a country</option>
                    <option value="ID">Indonesia</option>
                    <option value="SG">Singapore</option>
                    <option value="MY">Malaysia</option>
                    <option value="TH">Thailand</option>
                    <option value="PH">Philippines</option>
                    <option value="VN">Vietnam</option>
                    <option value="US">United States</option>
                    <option value="OTHER">Other</option>
                </select>
            </div>
            <div class="field">
                <label>Website (Optional)</label>
                <input type="url" id="web_url" placeholder="https://yourbrand.com">
            </div>
            <div class="field">
                <label>Description (Optional)</label>
                <input type="text" id="description" placeholder="Brief description">
            </div>
            <button type="submit" id="submit-btn">Create Brand & Continue</button>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        console.log('[GeoVera] Simple onboarding loaded');
        const SUPABASE_URL = 'https://vozjwptzutolvkvfpknk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvemp3cHR6dXRvbHZrdmZwa25rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODI0NzcsImV4cCI6MjA4NTQ1ODQ3N30.p-RiTR1Iva9Y4KiZu8gnF2CZjvnMWNAHUVCbp57PDF8';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const accessToken = localStorage.getItem('access_token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        console.log('[GeoVera] User:', user.id);
        
        if (!accessToken || !user.id) {
            console.error('[GeoVera] No session');
            window.location.href = '/login.html';
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type + ' show';
        }

        document.getElementById('onboarding-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating...';

            try {
                console.log('[GeoVera] Submitting...');
                const response = await fetch(`${SUPABASE_URL}/functions/v1/simple-onboarding`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${accessToken}`,
                        'apikey': SUPABASE_ANON_KEY,
                    },
                    body: JSON.stringify({
                        brand_name: document.getElementById('brand_name').value.trim(),
                        category: document.getElementById('category').value,
                        country: document.getElementById('country').value,
                        web_url: document.getElementById('web_url').value.trim() || null,
                        description: document.getElementById('description').value.trim() || null
                    })
                });

                const data = await response.json();
                console.log('[GeoVera] Response:', data);

                if (response.ok && data.success) {
                    showMessage('Success! Redirecting...', 'success');
                    setTimeout(() => window.location.href = '/dashboard.html', 1000);
                } else {
                    showMessage(data.error || 'Error occurred', 'error');
                }
            } catch (error) {
                console.error('[GeoVera] Error:', error);
                showMessage('Network error: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Create Brand & Continue';
            }
        });
    </script>
</body>
</html>
