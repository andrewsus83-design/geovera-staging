<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Diagnostic</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #0f0; }
        .pass { background: #002200; }
        .fail { background: #220000; color: #f00; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üîç GeoVera Diagnostic Tool</h1>
    <div id="tests"></div>
    <hr>
    <h3>Manual Tests:</h3>
    <button onclick="testTab()">Test Tab Click</button>
    <button onclick="testSupabase()">Test Supabase</button>
    <button onclick="testLogin()">Test Login Flow</button>
    
    <hr>
    <div id="manual-result"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const tests = [];
        
        function addTest(name, passed, message) {
            tests.push({name, passed, message});
            render();
        }

        function render() {
            const html = tests.map(t => 
                `<div class="test ${t.passed ? 'pass' : 'fail'}">
                    ${t.passed ? '‚úÖ' : '‚ùå'} ${t.name}: ${t.message}
                </div>`
            ).join('');
            document.getElementById('tests').innerHTML = html;
        }

        // AUTO TESTS
        addTest('Page Load', true, 'Diagnostic page loaded');
        addTest('JavaScript', true, 'JavaScript is running');
        addTest('Current URL', true, window.location.href);
        
        // Check Supabase library
        if (typeof window.supabase !== 'undefined') {
            addTest('Supabase Library', true, 'Loaded from CDN');
        } else {
            addTest('Supabase Library', false, 'NOT LOADED!');
        }

        // Check localStorage
        try {
            localStorage.setItem('test', 'ok');
            localStorage.removeItem('test');
            addTest('localStorage', true, 'Working');
        } catch(e) {
            addTest('localStorage', false, e.message);
        }

        // Check access token
        const token = localStorage.getItem('access_token');
        addTest('Access Token', !!token, token ? 'EXISTS' : 'NOT FOUND');

        // MANUAL TESTS
        function testTab() {
            const result = document.getElementById('manual-result');
            result.innerHTML = '<h3>Tab Click Test</h3><p>Tab functionality test...</p>';
            
            let clickCount = 0;
            const btn1 = document.createElement('button');
            const btn2 = document.createElement('button');
            
            btn1.textContent = 'Tab 1';
            btn2.textContent = 'Tab 2';
            
            btn1.onclick = () => {
                clickCount++;
                result.innerHTML += `<p>‚úÖ Tab 1 clicked! (${clickCount} clicks)</p>`;
            };
            
            btn2.onclick = () => {
                clickCount++;
                result.innerHTML += `<p>‚úÖ Tab 2 clicked! (${clickCount} clicks)</p>`;
            };
            
            result.appendChild(btn1);
            result.appendChild(btn2);
            result.innerHTML += '<p>üëÜ Try clicking the tabs above</p>';
        }

        async function testSupabase() {
            const result = document.getElementById('manual-result');
            result.innerHTML = '<h3>Supabase Test</h3><p>Testing connection...</p>';
            
            try {
                const SUPABASE_URL = 'https://vozjwptzutolvkvfpknk.supabase.co';
                const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvemp3cHR6dXRvbHZrdmZwa25rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODI0NzcsImV4cCI6MjA4NTQ1ODQ3N30.p-RiTR1Iva9Y4KiZu8gnF2CZjvnMWNAHUVCbp57PDF8';
                
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                const { data, error } = await supabase.from('gv_brands').select('id').limit(1);
                
                if (error) throw error;
                
                result.innerHTML += '<p>‚úÖ Supabase connection: SUCCESS</p>';
                result.innerHTML += `<p>Data returned: ${JSON.stringify(data)}</p>`;
            } catch(e) {
                result.innerHTML += `<p>‚ùå Supabase error: ${e.message}</p>`;
            }
        }

        async function testLogin() {
            const result = document.getElementById('manual-result');
            result.innerHTML = '<h3>Login Flow Test</h3>';
            result.innerHTML += '<p>Creating test login form...</p>';
            
            const form = document.createElement('form');
            form.innerHTML = `
                <input type="email" id="test-email" placeholder="Email" value="test@example.com"><br>
                <input type="password" id="test-password" placeholder="Password" value="test123"><br>
                <button type="submit">Test Submit</button>
            `;
            
            form.onsubmit = async (e) => {
                e.preventDefault();
                result.innerHTML += '<p>‚úÖ Form submit triggered!</p>';
                result.innerHTML += `<p>Email: ${document.getElementById('test-email').value}</p>`;
                result.innerHTML += `<p>Password: ${document.getElementById('test-password').value}</p>`;
            };
            
            result.appendChild(form);
        }

        console.log('Diagnostic ready. Tests:', tests);
    </script>
</body>
</html>
