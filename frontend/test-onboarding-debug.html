<!DOCTYPE html>
<html>
<head>
    <title>DEBUG Onboarding Test</title>
</head>
<body>
    <h1>DEBUG MODE - Onboarding Test</h1>
    <div id="status"></div>
    <button id="testBtn">TEST SUBMIT</button>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="env.js"></script>
    <script src="env-loader.js"></script>
    <script>
        const status = document.getElementById('status');
        
        function log(msg) {
            console.log('[DEBUG]', msg);
            status.innerHTML += '<p>' + msg + '</p>';
        }
        
        log('Page loaded');
        
        const ENV_CONFIG = window.getEnvConfig();
        const SUPABASE_URL = ENV_CONFIG.SUPABASE_URL;
        const SUPABASE_ANON_KEY = ENV_CONFIG.SUPABASE_ANON_KEY;
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const accessToken = localStorage.getItem('access_token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        log('Token: ' + (accessToken ? 'EXISTS' : 'MISSING'));
        log('User ID: ' + (user.id || 'MISSING'));
        
        document.getElementById('testBtn').addEventListener('click', async () => {
            log('Button clicked!');
            
            try {
                log('Calling Edge Function...');
                
                const response = await fetch(`${SUPABASE_URL}/functions/v1/simple-onboarding`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${accessToken}`,
                        'apikey': SUPABASE_ANON_KEY,
                    },
                    body: JSON.stringify({
                        brand_name: 'TEST BRAND DEBUG',
                        category: 'agency',
                        country: 'ID',
                        web_url: null,
                        description: null
                    })
                });
                
                log('Response status: ' + response.status);
                
                const data = await response.json();
                log('Response data: ' + JSON.stringify(data, null, 2));
                
                if (data.success) {
                    log('✅ SUCCESS!');
                } else {
                    log('❌ ERROR: ' + data.error);
                }
                
            } catch (error) {
                log('❌ EXCEPTION: ' + error.message);
                log('Stack: ' + error.stack);
            }
        });
    </script>
</body>
</html>
