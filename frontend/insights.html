<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Insights - GeoVera Intelligence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/accessibility.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --gv-hero: #16A34A; --gv-anchor: #0B0F19; --gv-body: #6B7280;
            --gv-canvas: #FFFFFF; --gv-divider: #E5E7EB; --gv-bg-light: #F9FAFB;
            --font-display: Georgia, 'Times New Roman', serif;
            --font-body: 'Inter', system-ui, -apple-system, sans-serif;
        }
        body { font-family: var(--font-body); background: var(--gv-bg-light); color: var(--gv-anchor); line-height: 1.6; }
        .site-header { background: var(--gv-anchor); color: white; border-bottom: 4px solid var(--gv-hero); position: sticky; top: 0; z-index: 1000; }
        .header-container { max-width: 1440px; margin: 0 auto; padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; min-height: 72px; }
        .header-logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: white; }
        .logo-icon { width: 44px; height: 44px; background: var(--gv-hero); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; }
        .logo-text { font-family: var(--font-display); font-weight: 700; font-size: 24px; letter-spacing: -0.02em; }
        .nav-desktop { display: flex; align-items: center; gap: 32px; }
        .nav-link { color: white; text-decoration: none; font-size: 14px; font-weight: 600; padding: 12px 16px; text-transform: uppercase; letter-spacing: 0.05em; min-height: 44px; display: flex; align-items: center; }
        .nav-link:hover { color: var(--gv-hero); }
        .nav-link.active { color: var(--gv-hero); }
        .user-button { background: var(--gv-hero); color: white; border: none; padding: 12px 20px; font-size: 14px; font-weight: 600; cursor: pointer; min-height: 44px; border-radius: 0; }
        .mobile-menu-toggle { display: none; }
        .main-container { max-width: 1440px; margin: 0 auto; padding: 32px 24px; }
        .page-header { background: white; border: 4px solid var(--gv-anchor); padding: 32px; margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; }
        .page-title { font-family: var(--font-display); font-size: 36px; font-weight: 700; letter-spacing: -0.02em; }
        .page-subtitle { font-size: 16px; color: var(--gv-body); margin-top: 8px; }
        .usage-badge { background: var(--gv-hero); color: white; padding: 8px 16px; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .filter-bar { background: white; border: 2px solid var(--gv-divider); padding: 24px; margin-bottom: 32px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
        .filter-button { background: transparent; border: 2px solid var(--gv-divider); padding: 10px 20px; font-size: 14px; font-weight: 600; cursor: pointer; min-height: 44px; border-radius: 0; transition: all 0.2s; }
        .filter-button.active { background: var(--gv-hero); color: white; border-color: var(--gv-hero); }
        .task-list { display: flex; flex-direction: column; gap: 16px; }
        .task-card { background: white; border: 2px solid var(--gv-divider); padding: 24px; transition: all 0.3s; display: flex; gap: 20px; }
        .task-card:hover { border-color: var(--gv-hero); transform: translateX(4px); }
        .task-icon { width: 48px; height: 48px; background: var(--gv-bg-light); border: 2px solid var(--gv-divider); display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        .task-content { flex: 1; }
        .task-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; }
        .task-title { font-weight: 700; font-size: 18px; }
        .task-priority { padding: 4px 12px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .priority-high { background: #FEE2E2; color: #DC2626; }
        .priority-medium { background: #FEF3C7; color: #D97706; }
        .priority-low { background: #DBEAFE; color: #2563EB; }
        .task-description { color: var(--gv-body); margin-bottom: 12px; }
        .task-actions { display: flex; gap: 12px; }
        .action-btn { padding: 8px 16px; font-size: 14px; font-weight: 600; cursor: pointer; border-radius: 0; min-height: 44px; transition: all 0.2s; border: none; }
        .action-primary { background: var(--gv-hero); color: white; }
        .action-secondary { background: transparent; color: var(--gv-anchor); border: 2px solid var(--gv-anchor); }
        .action-btn:hover { transform: translateY(-2px); }
        @media (max-width: 768px) {
            .nav-desktop { display: none; }
            .mobile-menu-toggle { display: block; }
            .page-header { flex-direction: column; align-items: flex-start; gap: 16px; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div role="status" aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>

    <header class="site-header" role="banner">
        <div class="header-container">
            <a href="index.html" class="header-logo" aria-label="GeoVera Intelligence">
                <div class="logo-icon">G</div>
                <span class="logo-text">GeoVera</span>
            </a>
            <nav class="nav-desktop" aria-label="Main navigation">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="insights.html" class="nav-link active" aria-current="page">Insights</a>
                <a href="hub.html" class="nav-link">Hub</a>
                <a href="radar.html" class="nav-link">Radar</a>
                <a href="content-studio.html" class="nav-link">Content Studio</a>
                <a href="chat.html" class="nav-link">AI Chat</a>
                <a href="settings.html" class="nav-link">Settings</a>
            </nav>
            <button class="user-button" id="user-btn">Account</button>
        </div>
    </header>

    <main class="main-container" id="main-content" role="main">
        <section class="page-header">
            <div>
                <h1 class="page-title">Daily Insights</h1>
                <p class="page-subtitle">AI-powered recommendations for your influencer strategy</p>
            </div>
            <div class="usage-badge" role="status" id="usage-badge">5/8 Tasks Today</div>
        </section>

        <div class="filter-bar" role="group" aria-label="Filter tasks">
            <button class="filter-button active" data-filter="all">All Tasks</button>
            <button class="filter-button" data-filter="crisis">Crisis</button>
            <button class="filter-button" data-filter="radar">Radar</button>
            <button class="filter-button" data-filter="search">Search</button>
            <button class="filter-button" data-filter="hub">Hub</button>
            <button class="filter-button" data-filter="chat">Chat</button>
        </div>

        <div class="task-list" id="task-list" role="list">
            <!-- Tasks loaded dynamically -->
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/frontend/config.js" type="module"></script>
    <script type="module">
        import config from '/frontend/config.js';
        const supabase = window.supabase.createClient(config.supabase.url, config.supabase.anonKey);

        const tierLimits = {
            basic: 8,
            premium: 10,
            partner: 12
        };

        const mockTasks = [
            { id: 1, type: 'radar', priority: 'high', title: 'New Trending Creator Alert', description: 'Beauty influencer @MayaGlam gained 50K followers this week in Indonesia', icon: 'ðŸ”' },
            { id: 2, type: 'crisis', priority: 'high', title: 'Brand Mention Spike', description: 'Your brand was mentioned 3x more than usual in the last 24 hours', icon: 'âš ï¸' },
            { id: 3, type: 'hub', priority: 'medium', title: 'Collection Engagement Drop', description: 'Beauty Hub collection engagement decreased 15% this week', icon: 'ðŸ“Š' },
            { id: 4, type: 'search', priority: 'medium', title: 'Keyword Opportunity', description: '"sustainable beauty" searches increased 40% in your target market', icon: 'ðŸ”Ž' },
            { id: 5, type: 'chat', priority: 'low', title: 'Content Ideas Available', description: 'Ask AI Chat for trending content ideas based on recent data', icon: 'ðŸ’¡' }
        ];

        let currentTier = 'basic';
        let tasksViewed = 5;

        async function loadTasks() {
            const user = await checkAuth();
            if (!user) return;

            // Get tier
            const { data: sub } = await supabase.from('gv_subscriptions').select('tier_name').eq('user_id', user.id).single();
            if (sub) currentTier = sub.tier_name;

            updateUsageBadge();
            displayTasks(mockTasks);
        }

        function updateUsageBadge() {
            const limit = tierLimits[currentTier];
            document.getElementById('usage-badge').textContent = `${tasksViewed}/${limit} Tasks Today (${currentTier.charAt(0).toUpperCase() + currentTier.slice(1)})`;
        }

        function displayTasks(tasks) {
            const html = tasks.map(task => `
                <article class="task-card" role="listitem">
                    <div class="task-icon" aria-hidden="true">${task.icon}</div>
                    <div class="task-content">
                        <div class="task-header">
                            <h3 class="task-title">${task.title}</h3>
                            <span class="task-priority priority-${task.priority}">${task.priority}</span>
                        </div>
                        <p class="task-description">${task.description}</p>
                        <div class="task-actions">
                            <button class="action-btn action-primary" onclick="viewTask(${task.id})">View Details</button>
                            <button class="action-btn action-secondary" onclick="dismissTask(${task.id})">Dismiss</button>
                        </div>
                    </div>
                </article>
            `).join('');
            document.getElementById('task-list').innerHTML = html;
        }

        document.querySelectorAll('.filter-button').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const filter = this.dataset.filter;
                const filtered = filter === 'all' ? mockTasks : mockTasks.filter(t => t.type === filter);
                displayTasks(filtered);
            });
        });

        window.viewTask = (id) => alert(`Viewing task ${id} details...`);
        window.dismissTask = (id) => alert(`Task ${id} dismissed!`);

        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) window.location.href = 'login.html';
            return user;
        }

        document.getElementById('user-btn').onclick = () => window.location.href = 'settings.html';
        loadTasks();
    </script>
</body>
</html>
